{"version":3,"file":"browser_ethereum_shim_raw.js","sources":["../src/browser_ethereum_shim.ts"],"sourcesContent":["export {};\n\ndeclare global {\n  interface Window {\n    ethereum: any;\n    ReactNativeWebView: any;\n  }\n}\nwindow.ethereum = {\n  isMetaMask: true,\n  isConnected,\n  on,\n  once,\n  off,\n  addListener: on,\n  removeListener: off,\n  removeAllListeners,\n  request,\n  _resolveRequest,\n  _rejectRequest,\n  emit,\n};\nfunction isConnected() {\n  return true;\n}\n\ntype Listener = (message: any) => void;\n\nfunction on(event: string, listener: Listener) {\n  _getEventHandler(event).on_list.push(listener);\n  return window.ethereum;\n}\nfunction once(event: string, listener: Listener) {\n  _getEventHandler(event).once_list.push(listener);\n  return window.ethereum;\n}\nfunction off(event: string, listener: Listener) {\n  const handler = _getEventHandler(event);\n  _filterInPlace(handler.on_list, (callback) => callback === listener);\n  _filterInPlace(handler.once_list, (callback) => callback === listener);\n  return window.ethereum;\n}\nfunction removeAllListeners(event: string) {\n  const handler = _getEventHandler(event);\n  handler.on_list = [];\n  handler.once_list = [];\n  return window.ethereum;\n}\nfunction emit(event: string, message: any) {\n  const handler = _getEventHandler(event);\n  const { once_list, on_list } = handler;\n  handler.once_list = [];\n  on_list.forEach((callback) => callback(message));\n  once_list.forEach((callback) => callback(message));\n}\n\ntype Executor = {\n  resolve: (result: any) => void;\n  reject: (error: any) => void;\n};\nlet g_requestId = 1;\nconst g_executorMap = new Map<number, Executor>();\nfunction request(args: any) {\n  return new Promise((resolve, reject) => {\n    const requestId = g_requestId++;\n    try {\n      g_executorMap.set(requestId, {\n        resolve,\n        reject,\n      });\n      const obj = {\n        requestId,\n        args,\n      };\n      const obj_s = JSON.stringify(obj);\n      window.ReactNativeWebView.postMessage(obj_s);\n    } catch (e) {\n      _rejectRequest(requestId, e);\n    }\n  });\n}\nfunction _resolveRequest(requestId: number, result: any) {\n  const executor = g_executorMap.get(requestId);\n  if (executor) {\n    g_executorMap.delete(requestId);\n    executor.resolve(result);\n  }\n}\nfunction _rejectRequest(requestId: number, result: any) {\n  const executor = g_executorMap.get(requestId);\n  if (executor) {\n    g_executorMap.delete(requestId);\n    executor.reject(result);\n  }\n}\ntype Handler = {\n  on_list: Listener[];\n  once_list: Listener[];\n};\nconst g_eventHandlerMap = new Map<string, Handler>();\nfunction _getEventHandler(event: string): Handler {\n  let ret = g_eventHandlerMap.get(event);\n  if (!ret) {\n    ret = {\n      on_list: [],\n      once_list: [],\n    };\n    g_eventHandlerMap.set(event, ret);\n  }\n  return ret;\n}\nfunction _filterInPlace(array: any[], callback: (a: any, b: any) => boolean) {\n  for (let i = array.length - 1; i >= 0; i--) {\n    if (!callback(array[i], i)) {\n      array.splice(i, 1);\n    }\n  }\n}\n"],"names":["on","event","listener","_getEventHandler","on_list","push","window","ethereum","off","handler","_filterInPlace","callback","once_list","isMetaMask","isConnected","once","addListener","removeListener","removeAllListeners","request","args","Promise","resolve","reject","requestId","g_requestId","g_executorMap","set","obj","obj_s","JSON","stringify","ReactNativeWebView","postMessage","e","_rejectRequest","_resolveRequest","result","executor","get","delete","emit","message","forEach","Map","g_eventHandlerMap","ret","array","i","length","splice"],"mappings":"2FA4BA,SAASA,EAAGC,EAAeC,GAEzB,OADAC,EAAiBF,GAAOG,QAAQC,KAAKH,GAC9BI,OAAOC,SAMhB,SAASC,EAAIP,EAAeC,GAC1B,MAAMO,EAAUN,EAAiBF,GAGjC,OAFAS,EAAeD,EAAQL,SAAUO,GAAaA,IAAaT,IAC3DQ,EAAeD,EAAQG,WAAYD,GAAaA,IAAaT,IACtDI,OAAOC,SAhChBD,OAAOC,SAAW,CAChBM,YAAY,EACZC,YAYF,WACE,OAAO,GAZPd,GAAAA,EACAe,KAoBF,SAAcd,EAAeC,GAE3B,OADAC,EAAiBF,GAAOW,UAAUP,KAAKH,GAChCI,OAAOC,UArBdC,IAAAA,EACAQ,YAAahB,EACbiB,eAAgBT,EAChBU,mBA0BF,SAA4BjB,GAC1B,MAAMQ,EAAUN,EAAiBF,GAGjC,OAFAQ,EAAQL,QAAU,GAClBK,EAAQG,UAAY,GACbN,OAAOC,UA7BdY,QA6CF,SAAiBC,GACf,OAAO,IAAIC,SAAQ,CAACC,EAASC,KAC3B,MAAMC,EAAYC,IAClB,IACEC,EAAcC,IAAIH,EAAW,CAC3BF,QAAAA,EACAC,OAAAA,IAEF,MAAMK,EAAM,CACVJ,UAAAA,EACAJ,KAAAA,GAEIS,EAAQC,KAAKC,UAAUH,GAC7BtB,OAAO0B,mBAAmBC,YAAYJ,GACtC,MAAOK,GACPC,EAAeX,EAAWU,QA3D9BE,gBA+DF,SAAyBZ,EAAmBa,GAC1C,MAAMC,EAAWZ,EAAca,IAAIf,GAC/Bc,IACFZ,EAAcc,OAAOhB,GACrBc,EAAShB,QAAQe,KAlEnBF,eAAAA,EACAM,KA4BF,SAAcxC,EAAeyC,GAC3B,MAAMjC,EAAUN,EAAiBF,IAC3BW,UAAEA,EAASR,QAAEA,GAAYK,EAC/BA,EAAQG,UAAY,GACpBR,EAAQuC,SAAShC,GAAaA,EAAS+B,KACvC9B,EAAU+B,SAAShC,GAAaA,EAAS+B,OAO3C,IAAIjB,EAAc,EAClB,MAAMC,EAAgB,IAAIkB,IA2B1B,SAAST,EAAeX,EAAmBa,GACzC,MAAMC,EAAWZ,EAAca,IAAIf,GAC/Bc,IACFZ,EAAcc,OAAOhB,GACrBc,EAASf,OAAOc,IAOpB,MAAMQ,EAAoB,IAAID,IAC9B,SAASzC,EAAiBF,GACxB,IAAI6C,EAAMD,EAAkBN,IAAItC,GAQhC,OAPK6C,IACHA,EAAM,CACJ1C,QAAS,GACTQ,UAAW,IAEbiC,EAAkBlB,IAAI1B,EAAO6C,IAExBA,EAET,SAASpC,EAAeqC,EAAcpC,GACpC,IAAK,IAAIqC,EAAID,EAAME,OAAS,EAAGD,GAAK,EAAGA,IAChCrC,EAASoC,EAAMC,GAAIA,IACtBD,EAAMG,OAAOF,EAAG"}